name: MacOS Workflow
on: [workflow_dispatch, push]

jobs:
  build_plugin:
    name: Build Plugin
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v2
      - name: Run compile script
        run: find . -name "*.xib" -type f | awk '{sub(/.xib/,"");print}' | xargs -I % ibtool --compile %.nib %.xib
        working-directory: ./ThorTypeFilter.glyphsFilter/Contents/Resources

      - name: Zip Directory
        run: zip -r ThorTypeFilter.glyphsFilter.zip ThorTypeFilter.glyphsFilter

      - uses: actions/checkout@v3
      - name: copy file via ssh password
        uses: appleboy/scp-action@v0.1.4
        with:
          host: scp.domeneshop.no
          username: tcarisland
          password: ${{ secrets.TCARISLAND_SFTP_PASSWD }}
          port: 22
          source: "ThorTypeFilter.glyphsFilter.zip"
          target: ~/www/thortype/filter
